# 2. JPA 시작

## JPA 매핑 어노테이션 
- `@Entity`: 엔티티 클래스, 이 클래스를 테이블과 매핑한다고 JPA에게 알려줌
- `@Table`: 엔티티 클래스에 매핑할 테이블 정보를 알려줌
  - 어노테이션 생략 시 클래스 이름을 테이블 이름으로 매핑
- `@Id`: 식별자 필드, 엔티티 클래스의 필드를 테이블의 기본 키(Primary Key)에 매핑
- `@Column`: 필드를 컬럼에 매핑
  - 매핑 어노테이션 생략 시 필드명을 사용해서 컬럼명으로 매핑

<br>
<br>

## 2.6 애플리케이션 개발 

<br>

### 2.6.1 엔티티 매니저 설정
- JPA 구동 방식
  1. META-INF/persistence.xml에서 설정 정보 조회
  2. EntityManagerFactory 생성
     - 엔티티 매니저 팩토리는 애플리케이션 전체에서 딱 한 번만 생성하고 공유해서 사용해야 함
  3. EntityManager 생성
     - 엔티티 매니저 팩토리에서 엔티티 매니저를 생성
     - JPA의 기능 대부분(엔티티를 데이터베이스에 등록,수정,삭제,조회)을 엔티티 매니저가 제공
     - 엔티티 매니저는 데이터베이스 커넥션과 밀접한 관계가 있으므로, 스레드 간에 공유하거나 재사용해서는 안됨 (사용하고 버려야 함) 
- 사용이 끝난 엔티티 매니저, 엔티티 매니저 팩토리는 종료해야 함
  ```java
  em.close()    // 엔티티 매니저 종료
  emf.close()   // 엔티티 매니저 팩토리 종료
  ```

<br>

### 2.6.2 트랜잭션 관리
- 주의) JPA의 모든 데이터 변경은 트랜잭션 안에서 실행해야 함
  - 트랜잭션 없이 데이터 변경 시 예외 발생
- 트랜잭션을 시작할 때는 엔티티 매니저에서 트랜잭션 API를 받아옴
- 트랜잭션 API를 사용해서 비즈니스 로직이 정상 동작하면 트랜잭션을 커밋(commit), 예외 발생 시 트랜잭션을 롤백(rollback)

<br>

### 2.6.4 JPQL
- JPA는 SQL을 추상화한 JPQL이라는 객체지향 쿼리 언어 제공
- SQL과 문법이 거의 유사
  - SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 등 사용 가능
- 둘의 가장 큰 차이점
  - JPQL: 엔티티 객체를 대상으로 쿼리 (클래스와 필드 대상, 디비 테이블을 전혀 알지 못함)
  - SQL: 데이터베이스 테이블을 대상으로 쿼리

<br>
<br>

## Reference
- [자바 ORM 표준 JPA 프로그래밍](http://www.yes24.com/Product/Goods/19040233) - 김영한 저. 에이콘출판사. 2015
